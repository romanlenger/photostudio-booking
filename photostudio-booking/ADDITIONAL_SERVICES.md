# 🎯 ДОДАТКОВІ ПОСЛУГИ - ІНСТРУКЦІЯ

## ✨ ЩО НОВОГО:

Тепер після підтвердження бронювання бот запитає про додаткові послуги:

### 💰 БАЗОВА ЦІНА: 1000 грн

### 📋 ДОДАТКОВІ ПОСЛУГИ:

#### 1️⃣ Кількість людей (Крок 1/4)
- **До 4 осіб** - безкоштовно ✅
- **Більше 4** - доплата **100 грн за кожного**
  - 5 осіб = 1000 + 100 = 1100 грн
  - 6 осіб = 1000 + 200 = 1200 грн

#### 2️⃣ Вибір фотозони (Крок 2/4)
- **Світла зона** - безкоштовно ✅
- **Темна зона** - безкоштовно ✅
- **Обидві зони** - доплата **500 грн**

#### 3️⃣ Домашні тварини (Крок 3/4)
- **Немає** - безкоштовно ✅
- **1 тварина** - безкоштовно ✅
- **Більше 1** - доплата **100 грн за кожну додаткову**
  - 2 тварини = 1000 + 100 = 1100 грн
  - 3 тварини = 1000 + 200 = 1200 грн

#### 4️⃣ Вибір фону (Крок 4/4)
- **Без фону** - безкоштовно ✅
- **Білий фон** - доплата **100 грн**
- **Чорний фон** - доплата **100 грн**
- **Червоний фон** - доплата **100 грн**

---

## 💡 ПРИКЛАД РОЗРАХУНКУ:

```
Базова ціна:        1000 грн
+ 6 осіб:          + 200 грн  (2 додаткові × 100)
+ Обидві зони:     + 500 грн
+ 2 тварини:       + 100 грн  (1 додаткова × 100)
+ Білий фон:       + 100 грн
━━━━━━━━━━━━━━━━━━━━━━━━━━━
РАЗОМ:              1900 грн
```

---

## 🔧 ВСТАНОВЛЕННЯ:

### 1️⃣ Оновити БД:

```bash
docker exec photostudio-booking-db-1 psql -U photostudio -d photostudio_db -f /migrations/003_add_additional_services.sql
```

Або вручну:

```sql
ALTER TABLE bookings ADD COLUMN IF NOT EXISTS people_count INTEGER;
ALTER TABLE bookings ADD COLUMN IF NOT EXISTS zone_choice VARCHAR(20);
ALTER TABLE bookings ADD COLUMN IF NOT EXISTS animals_count INTEGER;
ALTER TABLE bookings ADD COLUMN IF NOT EXISTS background_choice VARCHAR(20);
ALTER TABLE bookings ADD COLUMN IF NOT EXISTS total_price INTEGER DEFAULT 1000;

UPDATE bookings SET total_price = 1000 WHERE total_price IS NULL;
```

### 2️⃣ Оновити код:

```bash
# Скопіювати новий bot.py і models.py
docker-compose restart bot
docker-compose restart web
```

---

## 📱 FLOW КЛІЄНТА:

```
1. Сайт → Створення бронювання
   ↓
2. Telegram → Показ правил
   ↓
3. Клієнт → Підтвердження ✅
   ↓
4. Бот → Питання 1/4: Кількість людей?
   ↓
5. Бот → Питання 2/4: Яка зона?
   ↓
6. Бот → Питання 3/4: Тварини?
   ↓
7. Бот → Питання 4/4: Фон?
   ↓
8. Бот → Показ підсумку + реквізити
   ↓
9. Клієнт → Оплата + скріншот
   ↓
10. Адмін → Отримує всі деталі
```

---

## 📊 ЩО БАЧИТЬ АДМІН:

### При підтвердженні:
```
✅ Бронювання підтверджено

ID: #123
👤 Іван Петров
📞 +380123456789
💬 @ivan_petrov
📅 26.12.2024 14:00

📋 Обрані послуги:

👥 Людей: 6 осіб (+200₴)
📸 Зона: Обидві (+500₴)
🐾 Тварини: 2 (+100₴)
🎨 Фон: Білий (+100₴)

💰 Сума: 1900 грн

⏳ Чекаємо оплату...
```

### При оплаті:
```
💰 Квитанція

[Форвард скріншота]

ID: #123
👤 Іван Петров
📞 +380123456789
💬 @ivan_petrov
📅 26.12.2024 14:00

📋 Обрані послуги:
👥 Людей: 6 осіб (+200₴)
📸 Зона: Обидві (+500₴)
🐾 Тварини: 2 (+100₴)
🎨 Фон: Білий (+100₴)

💰 Сума: 1900 грн

❗️ Перевірте!
```

---

## 🗃️ СТРУКТУРА БД:

```sql
bookings:
  - people_count (INTEGER)        -- 4, 5, 6, ...
  - zone_choice (VARCHAR)         -- 'light', 'dark', 'both'
  - animals_count (INTEGER)       -- 0, 1, 2, ...
  - background_choice (VARCHAR)   -- 'none', 'white', 'black', 'red'
  - total_price (INTEGER)         -- Розрахована ціна
```

---

## 🎨 КНОПКИ В БОТІ:

### Крок 1 - Люди:
```
┌─────────────────┐
│ 👥 До 4 осіб    │
├─────────────────┤
│ 👥 Більше 4 осіб│
└─────────────────┘
```

### Крок 2 - Зона:
```
┌──────────────────┐
│ ☀️ Світла зона   │
├──────────────────┤
│ 🌙 Темна зона    │
├──────────────────┤
│ ✨ Обидві (+500₴)│
└──────────────────┘
```

### Крок 3 - Тварини:
```
┌─────────────────┐
│ 🚫 Немає тварин │
├─────────────────┤
│ 🐾 1 тварина    │
├─────────────────┤
│ 🐾🐾 Більше 1   │
└─────────────────┘
```

### Крок 4 - Фон:
```
┌──────────────────────┐
│ 🚫 Без фону          │
├──────────────────────┤
│ ⚪ Білий (+100₴)     │
├──────────────────────┤
│ ⚫ Чорний (+100₴)    │
├──────────────────────┤
│ 🔴 Червоний (+100₴) │
└──────────────────────┘
```

---

## 🔧 ФУНКЦІЇ В КОДІ:

### `calculate_price(people, zone, animals, bg)`
Розраховує фінальну ціну на основі вибраних послуг.

### `format_services(people, zone, animals, bg, price)`
Форматує красиве повідомлення з підсумком послуг.

### `start_services(query, context, booking_id)`
Запускає процес вибору додаткових послуг.

### `finalize(query, context)`
Завершує бронювання, зберігає в БД, відправляє реквізити.

---

## ✅ ПЕРЕВАГИ:

- ✨ Прозора ціна для клієнта
- 💰 Автоматичний розрахунок
- 📊 Адмін бачить всі деталі
- 🎯 Зручний вибір послуг
- 💾 Все зберігається в БД
- 📱 Інтуїтивний інтерфейс

---

## 🐛 TROUBLESHOOTING:

### Бот не запитує про послуги:
```bash
docker-compose logs bot
docker-compose restart bot
```

### Помилка БД:
```sql
-- Перевірити чи є колонки
\d bookings

-- Застосувати міграцію
\i /migrations/003_add_additional_services.sql
```

### Неправильна ціна:
Перевірити функцію `calculate_price()` в bot.py

---

**ВСЕ ПРАЦЮЄ! ТЕПЕР З ДОДАТКОВИМИ ПОСЛУГАМИ! 🎉**
